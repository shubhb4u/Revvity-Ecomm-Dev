<template>

    <div class="page">

        <!-- Top nav / back -->
        <div class="page-header slds-p-vertical_medium slds-border_bottom">
            <div class="slds-grid">
                <div class="slds-col">
                    <lightning-button-icon icon-name="utility:chevronleft" variant="bare" class="back-icon"
                        alternative-text="Back">
                    </lightning-button-icon>
                    <a href="javascript:void(0)"> Back to my quotes</a>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Header row: title left, button right -->
            <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center header-row">
                <div class="slds-col slds-p-right_small">
                    <h1 class="quote-title">Quote number: {quoteNumber}</h1>
                </div>
                <div class="slds-col slds-text-align_right">
                    <button class="btn btn-pill btn-outline">Download Quote</button>
                </div>
            </div>

            <!-- Stats row: 4 blocks, responsive -->
            <div class="stats-wrap slds-grid slds-wrap slds-m-top_medium">
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-4">
                    <span class="stat-label">Valid until :</span>
                    <span class="stat-value">
                        <template if:true={expirationDate}>
                            <lightning-formatted-date-time value={expirationDate} year="numeric" month="long"
                                day="2-digit"></lightning-formatted-date-time>
                        </template>
                        <template if:false={expirationDate}>—</template>
                    </span>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-4">
                    <span class="stat-label">Total:</span>
                    <span class="stat-value">
                        <template if:true={grandTotal}>
                            <lightning-formatted-number value={grandTotal} format-style="currency"
                                currency-code={currencyCode}></lightning-formatted-number>
                        </template>
                        <template if:false={grandTotal}>—</template>
                    </span>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-4">
                    <span class="stat-label">Items:</span>
                    <span class="stat-value">{itemsCount}</span>
                </div>

                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-4">
                    <span class="stat-label">Status:</span>
                    <span class="stat-value status-active">{status}</span>
                </div>
            </div>

            <!-- Section title -->
            <h2 class="section-title slds-m-top_xx-large">Shipping &amp; billing information</h2>

            <!-- Addresses: 3 equal columns, responsive -->
            <div class="slds-grid slds-wrap slds-m-top_medium info-columns">
                <!-- Shipping address -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                    <div class="info-block">
                        <div class="info-title">Shipping address</div>
                        <div class="info-text">
                            {shipCompany}<br />
                            {shipStreet}<br />
                            {shipCity}, {shipState} {shipPostal}<br />
                            {shipCountry}
                        </div>

                        <div class="info-title slds-m-top_medium">Attention / recipient</div>
                        <div class="info-text">{recipient}</div>

                        <div class="info-title slds-m-top_medium">Delivery instructions</div>
                        <div class="info-text">{deliveryInstructions}</div>

                        <div class="info-title slds-m-top_medium">Active account</div>
                        <div class="info-text">Account Number: {accountNumber}</div>
                    </div>
                </div>

                <!-- Billing address -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                    <div class="info-block">
                        <div class="info-title">Billing address</div>
                        <div class="info-text">
                            {billCompany}<br />
                            {billStreet}<br />
                            {billCity}, {billState} {billPostal}<br />
                            {billCountry}
                        </div>

                        <div class="info-title slds-m-top_medium">Email to invoice</div>
                        <div class="info-text">{invoiceEmail}</div>

                        <div class="info-title slds-m-top_medium">VAT</div>
                        <div class="info-text">{vatNumberMasked}</div>

                        <div class="info-title slds-m-top_medium">Codice commessa</div>
                        <div class="info-text">{projectCode}</div>
                    </div>
                </div>

                <!-- Invoice mailing address -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-3">
                    <div class="info-block">
                        <div class="info-title">Invoice mailing address</div>
                        <div class="info-text">
                            {invoiceCompany}<br />
                            {invoiceStreet}<br />
                            {invoiceCity}, {invoiceState} {invoicePostal}<br />
                            {invoiceCountry}
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Items header & actions -->
        <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center slds-m-top_x-large items-header">
            <div class="slds-col">
                <h2 class="section-title">Items</h2>
            </div>
            <div class="slds-col slds-text-align_right items-actions">
                <button class="btn btn-pill btn-outline slds-m-right_small">Request modification</button>
                <button class="btn btn-pill btn-solid">Add quote to cart</button>
            </div>
        </div>

        <!-- Items table -->
        <div class="items-table slds-m-top_small">
            <!-- Header row (single row with column titles) -->
            <div class="row header">
                <div class="cell index">#</div>
                <div class="cell name">Name</div>
                <div class="cell price">Unit list price</div>
                <div class="cell price">Unit net price</div>
                <div class="cell qty">Quantity</div>
                <div class="cell total">Line total</div>
            </div>


            <!-- Lines -->
            <template for:each={lines} for:item="line" for:index="i">
                <!-- Two-row layout -->
                <div key={line.Id} class="row row-2line">
                    <!-- Row 1: index + name (name spans across) -->
                    <div class="cell index index-top">{i}.</div>
                    <div class="cell name name-top">
                        <div class="line-name">{line.ProductName}</div>
                    </div>

                    <!-- Row 2: index spacer + meta + prices + qty + total -->
                    <div class="cell index index-bottom"></div>

                    <!-- NEW: meta cell (holds Part# and Product description) -->
                    <div class="cell name-meta">
                        <div class="subtext">Part#: {line.ProductCode}</div>
                        <div class="subtext">Product description: {line.ProductFamily}</div>
                    </div>

                    <div class="cell price list-price">
                        <lightning-formatted-number value={line.ListPrice} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>

                    <div class="cell price net-price">
                        <lightning-formatted-number value={line.UnitNetPrice} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>

                    <div class="cell qty qty-cell">{line.Quantity}</div>

                    <div class="cell total total-cell">
                        <lightning-formatted-number value={line.LineTotal} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>
                </div>
            </template>
        </div>


    <div class="slds-m-top_xx-large totals-section">
        <h2 class="section-title">Total</h2>

        <div class="totals-wrap">
            <div class="totals-card slds-p-around_medium">
                <div class="totals-row slds-grid slds-grid_vertical-align-center slds-grid_align-spread">
                    <div class="totals-label">Subtotal</div>
                    <div class="totals-value">
                        <lightning-formatted-number value={subtotal} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>
                </div>

                <div class="totals-row slds-grid slds-grid_vertical-align-center slds-grid_align-spread">
                    <div class="totals-label">Freight</div>
                    <div class="totals-value">
                        <lightning-formatted-number value={freight} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>
                </div>

                <div class="totals-row slds-grid slds-grid_vertical-align-center slds-grid_align-spread">
                    <div class="totals-label">Tax</div>
                    <div class="totals-value">
                        <lightning-formatted-number value={tax} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>
                </div>

                <div
                    class="totals-row slds-grid slds-grid_vertical-align-center slds-grid_align-spread totals-row--saving">
                    <div class="totals-label totals-label--saving">Savings (10%)</div>
                    <div class="totals-value totals-value--saving">
                        <lightning-formatted-number value={savings} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>
                </div>

                <hr class="totals-divider" />

                <div
                    class="totals-row slds-grid slds-grid_vertical-align-center slds-grid_align-spread totals-row--grand">
                    <div class="totals-label totals-label--grand">Total:</div>
                    <div class="totals-value totals-value--grand">
                        <lightning-formatted-number value={grandTotal} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Optional Items -->
    <div class="slds-m-top_xx-large optional-section">
        <h2 class="section-title">Optional Items</h2>
        <p class="opt-subtitle">Not included in the quotation total</p>

        <!-- Optional items table (same two-row pattern as Items) -->
        <div class="opt-items-table slds-m-top_small">
            <!-- Header row -->
            <div class="row header">
                <div class="cell index">#</div>
                <div class="cell name">Name</div>
                <div class="cell price">Unit list price</div>
                <div class="cell price">Unit net price</div>
                <div class="cell qty">Quantity</div>
                <div class="cell total">Line total</div>
            </div>

            <!-- Lines -->
            <template for:each={optionalLines} for:item="oline" for:index="j">
                <div key={oline.Id} class="row row-2line">
                    <!-- Row 1: index + name -->
                    <div class="cell index index-top">{j}.</div>
                    <div class="cell name name-top">
                        <div class="line-name">{oline.ProductName}</div>
                    </div>

                    <!-- Row 2: index spacer + meta + prices + qty + total -->
                    <div class="cell index index-bottom"></div>
                    <div class="cell name-meta">
                        <div class="subtext">Part#: {oline.ProductCode}</div>
                        <div class="subtext">Product description: {oline.ProductFamily}</div>
                    </div>

                    <div class="cell price list-price">
                        <lightning-formatted-number value={oline.ListPrice} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>

                    <div class="cell price net-price">
                        <lightning-formatted-number value={oline.UnitNetPrice} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>

                    <div class="cell qty qty-cell">{oline.Quantity}</div>

                    <div class="cell total total-cell">
                        <lightning-formatted-number value={oline.LineTotal} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>
                </div>
            </template>
        </div>

        <!-- Red italic note -->
        <p class="opt-warning slds-m-top_small">
            Items listed as optional are not considered in calculations for freight and taxes where they apply.
            Consequently, these amounts can change if you elect to add optional items to your order.
        </p>

        <!-- Optional Items Total (compact card) -->
        <div class="optional-total-wrap slds-m-top_large">
            <h2 class="section-title">Total</h2>
            <div class="totals-card optional-card">
                <div
                    class="totals-row totals-row--grand slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                    <div class="totals-label totals-label--grand">Total:</div>
                    <div class="totals-value totals-value--grand">
                        <lightning-formatted-number value={grandTotalWithOptional} format-style="currency"
                            currency-code={currencyCode}></lightning-formatted-number>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

</template>